{% extends "layout.html" %} {% block content %}

    <div class="content">
                    <div class="row">
                        <div class="col-lg-12">
                            <!-- Main Dashboard Chart -->
                            <div class="block">
                                <div class="block-header">
                                    <ul class="block-options">
                                        <li>
                                            <button type="button" data-toggle="block-option" data-action="refresh_toggle" data-action-mode="demo"><i class="si si-refresh"></i></button>
                                        </li>
                                    </ul>
                                    <h3 class="block-title">Form Produk</h3>
                                </div>
                                <div class="block-content block-content-full bg-gray-lighter ">
                                      <form class="form-horizontal"  method="post" enctype="multipart/form-data" id="myForm">
                                        <input type="hidden" name="id" value="{{data.id}}">
                                       <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Kode Produk</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="kodeProduk" name="kodeProduk" class="form-control" value="{{ data.kodeProduk }}"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Kode Penerbit</label></div>
                                            <div class="col-12 col-md-9">
                                                <select id="kodePenerbit" name="kodePenerbit" class="form-control">
                                                
                                                <option>--- Pilih ---</option>
                                                {% for penerbit in penerbit %}
                                                <option value="{{penerbit.kodePenerbit}}" {% if penerbit.kodePenerbit == data.kodePenerbit %} selected="" {% endif %} >{{penerbit.nama}}</option>
                                                {% endfor %}
                                            </select>
                                            </div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Kode Penulis</label></div>
                                            <div class="col-12 col-md-9">
                                            <select id="kodePenulis" name="kodePenulis" class="form-control">
                                               
                       
                                                <option>--- Pilih ---</option>
                                                {% for penulis in penulis %}
                                                <option value="{{penulis.kodePenulis}}" {% if penulis.kodePenulis == data.kodePenulis %} selected="" {% endif %} >{{penulis.namaPenulis}}</option>
                                                {% endfor %}
                                            </select>
                                            </div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Kategori</label></div>
                                            <div class="col-12 col-md-9">
                                            <select id="kategori" name="kategori" class="form-control">
                                            
                                                <option>--- Pilih ---</option>
                                                {% for kategori in kategori %}
                                                <option value="{{kategori.kategori}}" {% if kategori.kategori == data.kategori %} selected="" {% endif %} >{{kategori.kategori}}</option>
                                                {% endfor %}
                                            </select>
                                            </div>
                                        </div>

                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">ISBN</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="isbn" name="isbn" class="form-control" value="{{ data.isbn }}"></div>
                                        </div>

                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Nama Buku</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="namaBuku" name="namaBuku" class="form-control" value="{{ data.namaBuku }}"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Tanggal</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="tanggal" name="tanggal" class="form-control datepicker" value="{{ data.tanggal }}"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Ukuran</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="ukuran" name="ukuran" class="form-control" value="{{ data.ukuran }}"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Berat</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="berat" name="berat" class="form-control" value="{{ data.berat }}"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Tahun Terbit</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="tahunTerbit" name="tahunTerbit" class="form-control" value="{{ data.tahunTerbit }}"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Isi</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="isi" name="isi" class="form-control" value="{{ data.isi }}"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Stok</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="stok" name="stok" class="form-control " value="{{ data.stok }}"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Harga</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="harga" name="harga" class="form-control" value="{{ data.harga }}" onchange="Disc()"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Diskon</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="diskon" name="diskon" class="form-control" value="{{ data.diskon }}" onchange="Disc()"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Total Harga</label></div>
                                            <div class="col-12 col-md-9"><input type="text" id="totalHarga" name="totalHarga" class="form-control" value="{{ data.totalHarga }}" readonly="" style="background: #f9f9f9 ;"></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Deskripsi</label></div>
                                            <div class="col-12 col-md-9"><textarea id="deskripsi" name="deskripsi" class="form-control" value="{{ data.deskripsi }}" rows="9">{{ data.deskripsi }}</textarea></div>
                                        </div>
                                        <div class="row form-group">
                                            <div class="col col-md-3"><label for="text-input" class=" form-control-label">Foto</label></div>
                                            <div class="col-12 col-md-9"><input type="file" id="file" name="file" class="form-control" value="{{ data.foto }}"></div>
                                        </div>
                                       <div class="form-group">
                                            <div class="col-md-8 col-md-offset-2">
                                                <button type="button" id="btnAdd" onclick="addData()" class="btn btn-primary " >Add</button>
                                                <button type="button" id="btnUpdate" onclick="updateData()" class="btn btn-success">Update</button>
                                                <button type="reset" class="btn btn-danger ">Reset</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <!-- END Main Dashboard Chart -->
                        </div>
                     
                    </div>
                  
                </div>

{% endblock %}

{% block js %}

    <script  type="text/javascript">         

   $(document).ready(function() { 

        $('.datepicker').datepicker({
                autoclose: true,
                format: "yyyy-mm-dd",
                todayHighlight: true,
                orientation: "top auto",
                todayBtn: true,
                todayHighlight: true,  
            });

        $("#tahunTerbit").datepicker( {
            format: " yyyy",
            viewMode: "years", 
            minViewMode: "years",
             orientation: 'auto top'
        });

        var show = document.getElementById('kodeProduk').value;

        if(show == "")
        {
            $('#btnAdd').add();
            $('#btnUpdate').remove();
        }
        else
        {
            $('#btnAdd').remove();
            $('#btnUpdate').add();
        }
    });

   function Disc() {
       var harga = (document.getElementById('harga').value ? document.getElementById('harga').value : 0);
       var diskon = document.getElementById('diskon').value;
       var total = 0;
       totalHarga = 0;

       total = (parseInt(harga) / 100) * parseInt(diskon) ;
       
       totalHarga = parseInt(harga) - total ;

       document.getElementById('totalHarga').value = totalHarga;
   }

    function addData()
    {
        $('#btnAdd').text('Adding...'); //change button text
        $('#btnAdd').attr('disabled',true); //set button disable 
        var status = true;
        var url = "{{ base_url }}sys/Produk/addData";

        var formdata = new FormData();      
        // append tipe file
        var file = $('#file')[0].files[0];
        formdata.append('file', file);

        $.each($('#myForm').serializeArray(), function(a, b){
            formdata.append(b.name, b.value);
        });
     
        var formData = new FormData($('#myForm')[0]);

    if (status==true) {
            // ajax adding data to database
            $.ajax({
                url : url,
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                dataType: "JSON",
                success: function(data)
                {
                        alert("Menyimpan"); 
                        window.location = "{{ base_url }}sys/Produk/showData";
                  
                    $('#btnAdd').text('Add'); //change button text
                    $('#btnAdd').attr('disabled',false); //set button enable 
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    alert("Gagal Menyimpan");
                    $('#btnAdd').text('Add'); //change button text
                    $('#btnAdd').attr('disabled',false); //set button enable 

                }
            });
        }
        else
        {
            $('#btnAdd').text('Add'); //change button text
            $('#btnAdd').attr('disabled',false); //set button enable 
        }
    }

    function updateData()
    {
        $('#btnUpdate').text('Updating...'); //change button text
        $('#btnUpdate').attr('disabled',true); //set button disable 
        var status = true;
        var url = "{{ base_url }}sys/Produk/updateData";


         var formdata = new FormData();      
        // append tipe file

       
            var file = $('#file')[0].files[0];
            formdata.append('file', file);
       
        

        $.each($('#myForm').serializeArray(), function(a, b){
            formdata.append(b.name, b.value);
        });
     
        var formData = new FormData($('#myForm')[0]);

    if (status==true) {
            // ajax adding data to database
            $.ajax({
                url : url,
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                dataType: "JSON",
                success: function(data)
                {
                    if (data.status) {
                        alert("Menyimpan"); 
                        window.location = "{{ base_url }}sys/Produk/showData";
                        
                    }
                    $('#btnUpdate').text('Update'); //change button text
                    $('#btnUpdate').attr('disabled',false); //set button enable 
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    alert("Gagal Menyimpan");
                    $('#btnUpdate').text('Update'); //change button text
                    $('#btnUpdate').attr('disabled',false); //set button enable 

                }
            });
        }
        else
        {
            $('#btnUpdate').text('Update'); //change button text
            $('#btnUpdate').attr('disabled',false); //set button enable 
        }
    }  
            

    </script>
  

{% endblock %}